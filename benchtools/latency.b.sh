#!/bin/bash

cat <<EOT
# Latency (autogenerated, do not edit!)

RESULTDIR=/home/ingo/memtester/results/latency-2012-09-25
EOT
. common.sh

echo "iterate 5000"

for bench in tbench; do
	echo "# ================= bench: $bench ================="
	for speed in none slow full burn; do
		echo "# ----------------- speed: $speed -----------------"
		FILENAME=latency-$bench-$speed
		if [ $speed = none ]; then
			# no claimer
			FILENAME=$FILENAME-none-"<ITERATION>"
			bench_init "no claimer"
			bench_run $bench $FILENAME
			bench_finish $FILENAME
		elif [ $speed = burn ]; then
			# no claimer but cpuburn
			FILENAME=$FILENAME-none-"<ITERATION>"
			bench_init "no claimer but cpuburn"
			echo "run <SCRIPTDIR>/start-cpuburn.sh"
			bench_run $bench $FILENAME
			bench_finish $FILENAME
		else
			for claimer in b bh bhs; do
				FILENAME_CLAIMER=$FILENAME-$claimer-"<ITERATION>"
				bench_init "claimer=$claimer"
				if [ $speed = slow ]; then
					MTARGS=MTARGS_SLOW
				elif [ $speed = full ]; then
					MTARGS=MTARGS_FULL
				else
					echo "WTF?" >&2
					exit 1
				fi
				memtester $FILENAME_CLAIMER $MTARGS $claimer
				bench_run $bench $FILENAME_CLAIMER
				bench_finish $FILENAME_CLAIMER
			done
		fi
	done
done

echo "enditer"
echo "reboot"
